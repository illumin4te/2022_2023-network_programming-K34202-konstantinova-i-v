University: ITMO University Faculty: FICT Course: Network programming Year: 2022/2023 Group: K34202 Author: Konstantinova Iuliia Vyacheslavovna Lab: Lab1 Date of create: 10.02.2023 Date of finished:

Цель: c помощью Ansible и Netbox собрать всю возможную информацию об устройствах и сохранить их в отдельном файле.

Ход работы:

Для NetBox создана виртуальная машина Ubuntu 20.04 на хосте. Она была соединена с виртуальной машиной в облаке Яндекса, используя Wireguard по аналогии с первой лабораторной работой. Проверено, что связь есть (192.168.6.1 - IP адрес виртуальной машины в Яндексе) (Рис.1).
 
 ![image](https://user-images.githubusercontent.com/90499135/230200938-2e398e12-793b-4fd5-b5b2-12bb4e2b4fa3.png)

Рисунок 1 – Проверка соединения

Далее был запущен Netbox. Установлен и настроен postgresql. Создана база данных Netbox с одноимённым пользователем. После этого настроен nginx, туда добавлена информация о Netbox. Запущен Netbox и проверена корректность работы (Рис.2).
 
 ![image](https://user-images.githubusercontent.com/90499135/230200999-ccbe248c-e204-4bb4-85b6-69b81044a27d.png)

Рисунок 2 – Запуск Netbox 

Изначально при открытии ссылки на netbox в браузере на главной странице нет никакой информации. Поэтому туда внесено два роутера и информация о них (Рис.3). 

 ![image](https://user-images.githubusercontent.com/90499135/230201063-af7ba107-82fd-45c9-ade6-dddd99e2863c.png)

Рисунок 3 – Главная страница netbox

Затем было выполнено подключение по ssh с виртуальной машины Ubuntu на облачную машину и при помощи команды scp передан файл в облачную машину (Рис.4). 
 
 ![image](https://user-images.githubusercontent.com/90499135/230201116-b5a11f2b-d3c1-4120-a2a0-e39dde9d65b5.png)

Рисунок 4 – Необходимые файлы

Далее начата работа с плейбуком. Необходимо было спарсить csv файл и записать нужную информацию о роутере в отдельный файл (Рис.5). Выполена проверка правильности вывода (Рис.6).

 ![image](https://user-images.githubusercontent.com/90499135/230201183-029f8333-085c-48d4-a4b7-116bbc788682.png)

Рисунок 5 – Playbook 
 
 ![image](https://user-images.githubusercontent.com/90499135/230201229-094feae4-9de6-4449-b576-7268c432472d.png)

Рисунок 6 – Вывод

Затем была дописана часть, связанная с установкой названия роутера. И запущен весь плейбук целиком, в результате чего берётся имя роутера из csv файла, сгенерированного Netbox, и это имя присваивается подключенному роутеру. Проверена корректность работы (Рис.7). Имя роутера также изменилось в консоли микротика.
 
 ![image](https://user-images.githubusercontent.com/90499135/230201310-f0865272-1155-431f-8a6b-4787ec1521ce.png)

Рисунок 7 – Проверка корректности работы

Далее был написан скрипт создания девайса в Netbox (Рис.8). Была произведена проверка создания девайса.
 
 ![image](https://user-images.githubusercontent.com/90499135/230201389-c2041f99-7e20-41e6-a3f4-e460a0498c55.png)

Рисунок 8 – Создание девайса

Далее реализовано извлечение информации из Микротика и её передача в файл на виртуальной машине в облаке (Рис.9). Эта информация также внесена в Netbox.
 
 ![image](https://user-images.githubusercontent.com/90499135/230201460-d2d83ff0-71d3-4f1c-a4ee-ec5b2f1afff7.png)

Рисунок 9 – Передача информации

Затем запущен итоговый файл, проверен корректный вывод от ansible (Рис.10). Также в Netbox проверено сохранение изменений. Обнаружена информация о добавлении R1, что свидетельствует о выполнении задачи (Рис.11).
 
 ![image](https://user-images.githubusercontent.com/90499135/230201556-13d9a09e-37c4-44ca-bcc6-4ac1da49aba7.png)

Рисунок 10 – Проверка работоспособности
 
 ![image](https://user-images.githubusercontent.com/90499135/230201621-19d3ba4a-bbbd-4d25-94a2-af090ac8d410.png)

Рисунок 11 – Проверка выполнения

В ходе выполнения работы схема сети не была изменена (Рис.12).

![image](https://user-images.githubusercontent.com/90499135/230202091-353b31ec-8f16-4bc7-a7ed-036b5f07c94e.png)

Рисунок 12 - Схема сети
Вывод: в ходе выполнения работы все задачи выполнены, а именно была выполнена установка и настройка netbox. Написаны ansible playbooks для взаимодействия ранее настроенных роутеров и netbox. 
